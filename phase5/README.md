# Phase 5: Historical Back-testing (2019 일본 수출규제)

## 개요

과거 실제 사건을 기반으로 모델의 예측력과 재배선 추천 성능을 검증합니다.

**Case Study**: 2019년 7월 일본 수출규제 (반도체 핵심 소재)

## 시나리오: 2019년 일본 수출규제

### 배경
2019년 7월 4일, 일본이 반도체와 디스플레이 생산에 필수적인 3대 핵심 소재에 대한 수출규제 시행:
1. **불화수소** (고순도 불산)
2. **포토레지스트** (감광액)
3. **불화폴리이미드**

### 영향
- **불화수소**: 수출규제 이후 수입량 대폭 감소 → 국산화 진행
- **포토레지스트**: 타국가로부터 수입 대체
- **불화폴리이미드**: 국산화 완료 + 원재료 수입 지속

## 검증 방법

### Step 1: 충격 시나리오 구성
**Target KSIC 코드:**

**수출제한 품목 생산 기업 (공급자)**
- `C20129` 기타 기초 무기화학 물질 제조업
- `C20119` 기타 기초 유기 화학물질 제조업  
- `C20499` 그 외 기타 분류 안된 화학제품 제조업

**필수 기업 (Known Suppliers):**
- 솔브레인 (LI5265): C20499
- 램테크놀러지 (240623): C20119
- 이엔에프테크놀로지 (215316): C20499
- 동진쎄미켐 (355950): C20129
- 코오롱인더스트리 (F03302): C20501
- SKC (350885): C20499
- SK머티리얼즈 (093025): C20122

**수출제한 품목 사용 기업 (수요자)**
- `C26110` 전자집적회로 제조업
  - C26111 메모리용 전자집적회로 제조
  - C26112 비메모리용 및 기타 전자집적회로 제조
- `C26120` 다이오드, 트랜지스터 및 유사 반도체소자 제조업
  - C26121 발광 다이오드 제조업
  - C26129 기타 반도체 소자 제조업

**필수 기업 (Known Buyers):**
- 삼성전자 (380725): C26422
- SK하이닉스 (383511): C26120
- MEMC코리아 (452556): M72129
- 서울반도체 (092819): C26120
- SK실트론 (360651): C26120

### Step 2: 충격 주입 (Shock Injection)
1. **방법 A**: 일본 소재 기업 → 한국 반도체/화학 기업 간 엣지 삭제
2. **방법 B**: 해당 공급자의 `Total Sales` 또는 거래량을 0으로 설정

### Step 3: 모델 예측
**Input**: 2018년 네트워크 (충격 이전)
- 2018년 그래프 구조
- 2018년 노드 features
- 충격 시나리오 (삭제된 엣지 또는 변경된 features)

**Output**: 
- 위험 기업 리스트 (영향받을 기업 예측)
- 대체 거래처 추천 (재배선 경로)

### Step 4: 실제 데이터와 비교 (2020년)
**평가 지표:**

1. **예측력 (Prediction Accuracy)**
   - Hit Rate@K: 실제 재배선된 거래처를 Top-K에서 맞춘 비율
   - Recall@K: 실제 새로 형성된 엣지 중 모델이 추천한 비율
   - Precision@K: 모델이 추천한 엣지 중 실제로 형성된 비율

2. **안정성 (Resilience Simulation)**
   - 실제 총매출 감소폭 vs. 모델 추천 재배선 시 감소폭
   - 네트워크 연결성 변화 (Connected Components)
   - 공급망 집중도 변화 (Gini Coefficient)

## 파일 구조

```
phase5/
├── README.md                           # 이 파일
├── PHASE5_DESIGN.md                    # 상세 설계 문서
├── main_phase5.py                      # 메인 실행 스크립트
├── src/
│   ├── shock_injector.py              # 충격 시나리오 생성
│   ├── ksic_matcher.py                # KSIC 코드 기반 기업 매칭
│   ├── predictor.py                   # 재배선 예측
│   ├── evaluator.py                   # 성능 평가
│   └── visualizer.py                  # 결과 시각화
├── configs/
│   └── japan_export_restriction_2019.yaml  # 시나리오 설정
└── notebooks/
    └── phase5_analysis.ipynb          # 분석 노트북
```

## 사용 방법

### 1. 기본 실행
```bash
cd phase5
python main_phase5.py
```

### 2. 특정 시나리오 실행
```bash
python main_phase5.py --scenario japan_export_restriction_2019
```

### 3. 평가만 실행 (예측 결과 있을 때)
```bash
python main_phase5.py --eval-only --predictions results/predictions.npz
```

## 데이터 요구사항

### 필수 데이터
1. **2018년 네트워크**: `data/raw/posco_network_2018.csv`
2. **2019년 네트워크**: `data/raw/posco_network_2019.csv` (충격 직후)
3. **2020년 네트워크**: `data/raw/posco_network_2020.csv` (재배선 결과)
4. **KSIC 매핑**: `data/raw/firm_ksic_mapping.csv`
5. **기업 정보**: `data/raw/firm_info.csv` (업체번호, 업체명, 국가 등)

### 선택 데이터
- 주가 데이터 (이벤트 스터디용)
- 수출입 통계 (HS 코드 기반)

## 예상 결과

### 정량적 지표
- **Hit Rate@10**: 실제 재배선의 ~60-70% 포착 목표
- **Recall@100**: 새로운 거래처의 ~40-50% 포착 목표
- **매출 감소 완화**: 모델 추천 시 실제 대비 ~20-30% 감소폭 완화

### 정성적 분석
- 어떤 산업이 가장 영향을 많이 받았나?
- 국산화 vs. 수입 대체 패턴 분석
- 네트워크 구조 변화 (중심성, 클러스터링 등)

## 제한사항

1. **데이터 가용성**: 2018-2020년 데이터가 모두 필요
2. **인과관계**: 상관관계만 확인 가능 (진정한 인과관계는 어려움)
3. **외부 요인**: 다른 경제적 충격 요인 분리 어려움
4. **모델 한계**: 정책, 정치적 결정은 반영 불가

## 참고 문헌

1. 오석진, 이창민 (2020). "수출규제 3품목 수입동향 분석"
2. 한국은행 (2019). "일본의 수출규제 조치의 영향과 시사점"
3. 산업통상자원부 (2022). "소재·부품·장비 경쟁력강화 시행계획"

## 다음 단계

- [ ] KSIC 매칭 및 기업 선정
- [ ] 충격 시나리오 구현
- [ ] Phase 3 모델로 재배선 예측
- [ ] 2020년 실제 데이터와 비교
- [ ] 결과 시각화 및 보고서 작성
