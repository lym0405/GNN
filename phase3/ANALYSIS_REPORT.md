# Phase 3 μ½”λ“ λ¶„μ„ λ³΄κ³ μ„

**λ¶„μ„μΌ:** 2026-01-19

---

## π“ 1. μ„ν¬νΈ λ¨λ“ λ¶„μ„

### β… main.py μ„ν¬νΈ κµ¬μ΅°
```python
# ν‘μ¤€ λΌμ΄λΈλ¬λ¦¬
import sys, os
from pathlib import Path
import numpy as np
import torch
import torch.optim as optim
import logging

# Phase 3 λ‚΄λ¶€ λ¨λ“
from phase3.src.temporal_graph_builder import TemporalGraphBuilder
from phase3.src.sc_tgn import SC_TGN
from phase3.src.graphseal import GraphSEAL, HybridLinkPredictor
from phase3.src.hybrid_trainer import HybridTrainer
from phase3.src.negative_sampler import prepare_events_with_negatives
```

**β… μƒνƒ:** λ¨λ“  μ„ν¬νΈκ°€ λ…ν™•ν•κ² μ •μλ¨
- ν”„λ΅μ νΈ λ£¨νΈλ¥Ό sys.pathμ— μ¶”κ°€ν•μ—¬ μƒλ€ κ²½λ΅ ν•΄κ²°
- Phase 3 λ‚΄λ¶€ λ¨λ“λ§ μ‚¬μ© (Phase 2 μμ΅΄μ„± μµμ†ν™”)

---

## π“‹ 2. μ»¬λΌλ… μ‚¬μ© λ¶„μ„

### β… temporal_graph_builder.py μ»¬λΌλ… μ²λ¦¬ (λ§¤μ° νƒ„νƒ„ν•¨)

**μ°μ„ μμ„ μ‹μ¤ν…:**

1. **1μμ„:** ν•κΈ€ μ»¬λΌλ… (μ‹¤μ  λ°μ΄ν„°)
   ```python
   source_col = 'μ‚¬μ—…μλ“±λ΅λ²νΈ'
   target_col = 'κ±°λμ²μ‚¬μ—…μλ“±λ΅λ²νΈ'
   amount_col = 'μ΄κ³µκΈ‰κΈμ•΅'
   ```

2. **2μμ„:** λ¶€λ¶„ λ§¤μΉ­
   - `'μ‚¬μ—…μ'` + `'λ²νΈ'` (κ±°λμ² μ μ™Έ)
   - `'κ±°λμ²'` + `'μ‚¬μ—…μ'` + `'λ²νΈ'`
   - `'κ³µκΈ‰κΈμ•΅'` or `'κ±°λμ•΅'`

3. **3μμ„:** μλ¬Έ μ»¬λΌλ… (λ”λ―Έ λ°μ΄ν„°)
   - `source`, `target`, `amount`
   - `from`, `to`, `weight`

4. **4μμ„:** μΈλ±μ¤ κΈ°λ° ν΄λ°±
   - `df.columns[0]`, `df.columns[1]`, `df.columns[2]`

**β… μƒνƒ:** λ§¤μ° μ•μ •μ μΈ μ»¬λΌλ… μ²λ¦¬ μ‹μ¤ν…

---

### β… negative_sampler.py μ»¬λΌλ… μ²λ¦¬

**νμΌλ… μ²λ¦¬:**
```python
# 1μμ„: κΈ΄ νμΌλ…
f"posco_network_capital_consumergoods_removed_{year}.csv"

# 2μμ„: μ§§μ€ νμΌλ… (ν΄λ°±)
f"posco_network_{year}.csv"
```

**μ»¬λΌλ… μ²λ¦¬:**
```python
# 1μμ„: ν•κΈ€ (μ‹¤μ  λ°μ΄ν„°)
src_col = 'μ‚¬μ—…μλ“±λ΅λ²νΈ'
dst_col = 'κ±°λμ²μ‚¬μ—…μλ“±λ΅λ²νΈ'

# 2μμ„: μλ¬Έ (λ”λ―Έ λ°μ΄ν„°)
'Unnamed: 0', 'Unnamed: 1'
'source', 'target'
'src', 'dst'
```

**β… μƒνƒ:** μ‹¤μ  λ°μ΄ν„°μ™€ λ”λ―Έ λ°μ΄ν„° λ¨λ‘ μ§€μ›

---

### β… firm_to_idx λ§¤ν•‘ μ²λ¦¬

```python
# 1μμ„: Unnamed: 0, idx
firm_to_idx = dict(zip(
    firm_to_idx_df['Unnamed: 0'],
    firm_to_idx_df['idx']
))

# 2μμ„: firm_id, idx
firm_to_idx = dict(zip(
    firm_to_idx_df['firm_id'],
    firm_to_idx_df['idx']
))
```

**β… μƒνƒ:** μ μ—°ν• μ»¬λΌλ… μ²λ¦¬

---

## π§® 3. λ¨λΈ κ²½λ‰ν™” λ¶„μ„

### Track A: SC-TGN (Temporal Graph Network)

**κΈ°λ³Έ κµ¬μ„±:**
```python
SC_TGN(
    num_nodes=438,946,        # λ…Έλ“ μ
    node_dim=?,               # λ…Έλ“ ν”Όμ² μ°¨μ› (κ°€λ³€)
    edge_dim=2,               # μ—£μ§€ ν”Όμ² μ°¨μ›
    memory_dim=128,           # λ©”λ¨λ¦¬ μ°¨μ›
    time_dim=32,              # μ‹κ°„ μΈμ½”λ”© μ°¨μ›
    message_dim=128,          # λ©”μ‹μ§€ μ°¨μ›
    embedding_dim=64          # μµμΆ… μ„λ² λ”© μ°¨μ›
)
```

**λ¨λ“λ³„ νλΌλ―Έν„°:**

1. **MemoryModule** 
   - νλΌλ―Έν„°: **0κ°** (λ²„νΌλ§ μ‚¬μ©, λ™μ  μ—…λ°μ΄νΈ)
   - λ©”λ¨λ¦¬: `438,946 Γ— 128 = 56.2M floats (~225 MB)`

2. **TimeEncoder**
   - `Linear(1 β†’ 32)`: **32κ°**

3. **MessageAggregator**
   - Input: `memory_dim*2 + edge_dim + time_dim = 128*2 + 2 + 32 = 290`
   - Layer 1: `Linear(290 β†’ 128)`: `290 Γ— 128 + 128 = 37,248`
   - Layer 2: `Linear(128 β†’ 128)`: `128 Γ— 128 + 128 = 16,512`
   - **μ†κ³„: 53,760κ°**

4. **MemoryUpdater (GRUCell)**
   - Input: `message_dim = 128`, Hidden: `memory_dim = 128`
   - GRUCell νλΌλ―Έν„°: `(128 + 128) Γ— 128 Γ— 3 = 98,304`
   - **μ†κ³„: ~98Kκ°**

5. **NodeEncoder**
   - `Linear(node_dim β†’ memory_dim)`: κ°€λ³€ (node_dimμ— λ”°λΌ)

6. **EmbeddingLayer**
   - Layer 1: `Linear(memory_dim + node_dim β†’ 64)`
   - Layer 2: `Linear(64 β†’ 64)`: `64 Γ— 64 + 64 = 4,160`

**μ΄ νλΌλ―Έν„° μ¶”μ • (node_dim=100 κ°€μ •):**
- ~**200K - 300K νλΌλ―Έν„°**
- λ©”λ¨λ¦¬ ν’‹ν”„λ¦°νΈ: **~225 MB** (λ²„νΌ)

**β… ν‰κ°€:** κ²½λ‰ λ¨λΈ, λ©”λ¨λ¦¬ μ§‘μ•½μ μ΄μ§€λ§ νλΌλ―Έν„°λ” μ μ

---

### Track B: GraphSEAL (Structural Link Prediction)

**κΈ°λ³Έ κµ¬μ„±:**
```python
GraphSEAL(
    embedding_dim=32,         # Phase 2 μ„λ² λ”© μ°¨μ›
    hidden_dim=128,           # μ€λ‹‰μΈµ μ°¨μ›
    num_hops=2,               # μ„λΈκ·Έλν”„ ν™‰ μ
    use_ukge=True             # UKGE μ‚¬μ© μ—¬λ¶€
)
```

**λ¨λ“λ³„ νλΌλ―Έν„°:**

1. **SubgraphEncoder**
   - Hop Layer 1: `Linear(32 β†’ 128)`: `32 Γ— 128 + 128 = 4,224`
   - Hop Layer 2: `Linear(32 β†’ 128)`: `32 Γ— 128 + 128 = 4,224`
   - Output Layer: `Linear(256 β†’ 32)`: `256 Γ— 32 + 32 = 8,224`
   - **μ†κ³„: 16,672κ°**

2. **UKGEConfidenceScorer** (use_ukge=TrueμΈ κ²½μ°)
   - Input: `embedding_dim*2 + 1 = 32*2 + 1 = 65` (TIS ν¬ν•¨)
   - Layer 1: `Linear(65 β†’ 64)`: `65 Γ— 64 + 64 = 4,224`
   - Layer 2: `Linear(64 β†’ 1)`: `64 Γ— 1 + 1 = 65`
   - **μ†κ³„: 4,289κ°**

3. **LinkPredictor**
   - Layer 1: `Linear(64 β†’ 128)`: `64 Γ— 128 + 128 = 8,320`
   - Layer 2: `Linear(128 β†’ 64)`: `128 Γ— 64 + 64 = 8,256`
   - Layer 3: `Linear(64 β†’ 1)`: `64 Γ— 1 + 1 = 65`
   - **μ†κ³„: 16,641κ°**

**μ΄ νλΌλ―Έν„°:**
- **37,602κ°** (UKGE ν¬ν•¨)
- **33,313κ°** (UKGE μ μ™Έ)

**β… ν‰κ°€:** λ§¤μ° κ²½λ‰! 38K νλΌλ―Έν„°λ§ μ‚¬μ©

---

### Hybrid Model (Ensemble)

```python
HybridLinkPredictor(
    tgn_model=SC_TGN(...),
    graphseal_model=GraphSEAL(...),
    alpha=0.5  # Track A κ°€μ¤‘μΉ (ν•™μµλ¨)
)
```

**μ΄ νλΌλ―Έν„°:**
- Track A: ~**250K**
- Track B: ~**38K**
- Learnable alpha: **1κ°**
- **ν•©κ³„: ~288K νλΌλ―Έν„°**

**β… ν‰κ°€:** μ „μ²΄μ μΌλ΅ κ²½λ‰ λ¨λΈ (~300K νλΌλ―Έν„°)

---

## π― 4. λ¨λΈ κ²½λ‰ν™” μμ¤€ ν‰κ°€

### λΉ„κµ λ¶„μ„

| λ¨λΈ | νλΌλ―Έν„° μ | ν‰κ°€ |
|------|------------|------|
| **Track A (SC-TGN)** | ~250K | πΆ κ²½λ‰ |
| **Track B (GraphSEAL)** | ~38K | πΆ λ§¤μ° κ²½λ‰ |
| **Hybrid (μ „μ²΄)** | ~288K | πΆ κ²½λ‰ |
| **Phase 2 GraphSAGE** | ~μμ‹­λ§ | πΆ κ²½λ‰ |

### μ°Έκ³ : λ€ν• λ¨λΈκ³Ό λΉ„κµ
- GPT-2 Small: 124M νλΌλ―Έν„°
- BERT-base: 110M νλΌλ―Έν„°
- GCN (μΌλ°): μλ°±λ§~μμ‹­λ§ νλΌλ―Έν„°

**β… κ²°λ΅ :** Phase 3 λ¨λΈμ€ λ§¤μ° κ²½λ‰ν™”λμ–΄ μμ (< 300K)

---

## π¨ 5. μ„¤κ³„ ν’μ§ ν‰κ°€

### β… κ°•μ 

1. **μ»¬λΌλ… μ²λ¦¬:**
   - λ‹¤μΈµ ν΄λ°± μ‹μ¤ν…μΌλ΅ λ§¤μ° μ•μ •μ 
   - μ‹¤μ  λ°μ΄ν„°μ™€ λ”λ―Έ λ°μ΄ν„° λ¨λ‘ μ§€μ›
   - λ…ν™•ν• μ°μ„ μμ„

2. **λ¨λ“ κµ¬μ΅°:**
   - λ…ν™•ν• Track A/B λ¶„λ¦¬
   - κ° λ¨λ“μ μ—­ν• μ΄ λ…ν™•ν•¨
   - μ„ν¬νΈ μμ΅΄μ„± μµμ†ν™”

3. **κ²½λ‰ν™”:**
   - 38K (GraphSEAL) + 250K (SC-TGN) = 288K μ΄ νλΌλ―Έν„°
   - λ€κ·λ¨ κ·Έλν”„μ—μ„λ„ ν•™μµ κ°€λ¥

4. **λ©”λ¨λ¦¬ ν¨μ¨:**
   - SC-TGN λ©”λ¨λ¦¬λ” λ™μ  μ—…λ°μ΄νΈ (ν•™μµ νλΌλ―Έν„° μ•„λ‹)
   - μ‹¤μ  ν•™μµ νλΌλ―Έν„°λ” κ·Ήν μ μ

### β οΈ μ μ¬μ  κ°μ„  μ‚¬ν•­

1. **SubgraphEncoder κ³„μ‚° λΉ„μ©:**
   - k-hop μ΄μ›ƒ μ°ΎκΈ°λ” BFSλ΅ κµ¬ν„ β†’ λ€κ·λ¨ κ·Έλν”„μ—μ„ λλ¦΄ μ μμ
   - **κ°μ„ :** λ°°μΉ λ‹¨μ„ μƒν”λ§, μΊμ‹± ν™μ©

2. **MemoryModule λ©”λ¨λ¦¬ μ‚¬μ©λ‰:**
   - 438,946 λ…Έλ“ Γ— 128 μ°¨μ› = ~225 MB
   - **κ°μ„ :** ν¬μ† λ©”λ¨λ¦¬ (μμ£Ό μ‚¬μ©λλ” λ…Έλ“λ§ μ €μ¥)

3. **Historical Negatives λ΅λ“:**
   - λ§¤λ² CSV νμΌμ„ μ½μ
   - **κ°μ„ :** μΊμ‹± μ‹μ¤ν… ν™μ© (TemporalGraphBuilderμ²λΌ)

---

## π“ 6. μµμΆ… ν‰κ°€

### μΆ…ν•© μ μ

| ν•­λ© | μ μ | ν‰κ°€ |
|------|------|------|
| **μ„ν¬νΈ λ…ν™•μ„±** | 10/10 | β… μ™„λ²½ |
| **μ»¬λΌλ… μ•μ •μ„±** | 9/10 | β… λ§¤μ° μ°μ |
| **λ¨λΈ κ²½λ‰ν™”** | 9/10 | β… λ§¤μ° μ°μ (< 300K) |
| **μ½”λ“ κ°€λ…μ„±** | 9/10 | β… λ…ν™•ν• κµ¬μ΅° |
| **ν™•μ¥μ„±** | 8/10 | π΅ μ„λΈκ·Έλν”„ μ²λ¦¬ κ°μ„  κ°€λ¥ |

### μ΄ν‰

**β… Phase 3 μ½”λ“λ” λ§¤μ° μ μ„¤κ³„λμ—μµλ‹λ‹¤:**

1. **μ„ν¬νΈ:** λ…ν™•ν•κ³  μμ΅΄μ„± μµμ†ν™”
2. **μ»¬λΌλ…:** λ‹¤μΈµ ν΄λ°±μΌλ΅ μ•μ •μ 
3. **κ²½λ‰ν™”:** 288K νλΌλ―Έν„°λ΅ λ§¤μ° κ²½λ‰
4. **κµ¬μ΅°:** Track A/B λ¶„λ¦¬λ΅ λ¨λ“ν™” μ°μ

**κ¶μ¥ μ‚¬ν•­:**
- ν„μ¬ μƒνƒ κ·Έλ€λ΅ μ‚¬μ© κ°€λ¥
- ν•„μ”μ‹ SubgraphEncoder μΊμ‹± μ¶”κ°€ κ³ λ ¤
- Historical Negatives μΊμ‹± μ‹μ¤ν… μ¶”κ°€ κ³ λ ¤

---

**λ¶„μ„ μ™„λ£** β…
